ANALOG IMPLEMENTATIONS OFAUDITORY MODELSRichard F. LyonApple Computer, Inc.Cupertino, CA 95014and California Institute of TechnologyPasadena, CA 91125ABSTRACTThe challenge of making cost-effective implementations of auditorymodels has led us to pursue an analog VLSI micro-power approach.Experiments with the first few generations of analog cochlea chipsshowed some of both the potential and the problems of this approach.The inherent exponential behavior of MOS transistors in thesubthreshold or weak-inversion region leads to nonlinear filter circuits,in which the small-signal and large-signal behaviors can be quitedifferent.
Early problems with instability, poor dynamic range, andexcessive noise are now understood in terms of the transition behaviorbetween these regions, and this understanding has led us to design filterstages with appropriately compressive behavior, resulting in morerobust cochea performance.
Several types of correlator circuits tofollow the cochlea have also been developed into workingdemonstrations.
Videotapes of circuit outputs and simulationsillustrate the recent ideas and progress.INTRODUCTIONThe "Analog Electronic Cochlea" of Lyon and Mead \[1\] hasbeen presented as a very efficient way to implement a cochlearmodel in silicon.
It was shown to provide some of the basicfiltering properties and adaptability potential needed for acomprehensive auditory model.
However, we were not able totune the filters to give a pseudoresonant gain peak greater thanabout 20 dB, due to poorly understood circuit misbehaviors.In the hydrodynamic model on which our cascade filterbankmodel of the cochlea is based \[2\], the signals in the filtercascade correspond to either pressure (across the basilarmembrane) or velocity potential at the membrane (the spatialderivative of velocity potential is the fluid velocity vector).For the case of a passive cochlea, the respone of the filtersshould be monotonically decreasing with frequency; i.e.,lowpass.
But for a healthy active cochlea in a quietenvironment, he active outer hair cells should provide enoughgain to change the overal l  lowpass response to apseudoresonant bandpass-like response with a broad gain peakof perhaps as much as 60 dB.
Over a wide range of soundloudnesses, the filterbank gain should gradually transitionbetween these extremes, acting as an automatic gain control tocompress the dynamic range of signals at the output.
We havepreviously discussed the evidence for this kind of function infact occuring at the mechanical level \[3\].
We are now makingprogress on getting this behavior into our circuits.COCHLEA IMPROVEMENTSThe original cochlea chip was nothing more than a cascadeof two-pole filter stages (omitting the zeros of previous modelsthat had come from a long-wave analysis).
Further analysis ledus to expect three-pole stages to provide an even better fit tothe hydrodynamic short-wave analysis.
Most of the circuitsand behaviors discussed here apply with minor changes toeither type of stage.Tests on early second-order filter stages, including a low-noise version based on the MOSIS low-noise analog BiCMOSprocess, revealed a problematic nonlinear effect related to thesaturation of the tanh  input nonl inear i ty  of  thetransconductance amplifiers.
The filter stages ended up withmore gain for large signals than for small signals (i.e., theywere "expansive"), and the result was that a given periodicinput could lead to a pair of distinct periodic attractors.
In acascade of such filter stages, when the input became largeenough to kick any stage into the large-signal mode, the finalresult was a chaotic output waveform resembling fractralmountains.
This was neat, but not at all what we had in mind.We have since experimented with several ways to makeinherently compressive filter stages, with good results.
Withrecent circuits, we can tune the cochlea to have a peak gainclose to 40 dB, rather than the 12 dB previously shown.
Thispeak gain is closely related to both sharpness and dynamicrange, as will be discussed.Filter circuitsThe first-order and second-order circuits of figures 1 and 2 areanalyzed by Mead \[4\], including some of the large-signalbehavior.
The small signal, or linear, regime of operation ofthe modified second-order and third-order circuits of figures 3and 4 are easily analyzed in the same way.
The third-ordercircuit yields a complex pole pair plus a real pole; the sameeffect can also be achieved by cascading a first-order sectionand either of the second-order section designs, in either order.Several other circuit variations have also been considered, buthere only the ones actually built and tested are discussed.In k >l out I--VFigure 1: The circuit for a first-order (one-pole) section.
Theamplifier symbol represents a transconductance amplifier,which in subthreshold MOS has an inherent tanh(v)nonlinearity.
Time constants in this design style arecontrolled by transconductances and capacitances, rather thanby resistances and capacitances.212InT 1 T 2OutFigure 2: The circuit for Mead's classic "ORD2" second-ordersection.
All capacitors used are approximately identical,typically around 1 pF or less.In I OutT 1 T I 2 --q-Figure 3: The circuit for the "DIF2" second-order section,which is a simpler circuit with slightly more complicated Q-control.T -I- -I-Figure 4: The circuit for the "DIF3" third-order section, whichleads to a more accurate model of short-wave hydrodynamics.In figures 1-4, the amplifier symbols represent abstracttransconductance amplifiers.
The circuits used to realize theminherently compress the input differential voltage through ahyperbolic tangent function whose "width" is fixed by thedevice physics and temperature, and largely independent ofdevice geometry.
The small-signal transconductance (gain) ofeach amplifier is a temperature-dependent co stant times thebias current of that amplifier.
The bias current is also equal tothe output saturation current corresponding to tanhO=l.
Thelabels x, etc., are used to indicate the time constants controlledby the bias currents of each amplifier ('t = C/g, where g is thetransductance and C is the capacitance).In testing an ORD2 stage, we noticed that for somemoderate-level input signals of fixed frequency and amplitude,two different output amplitudes were possible.
A frequencysweep showed a double-valued transfer function magnitude withhysteresis.
Essentially, both the small-signal nd large-signalregimes were stable, but with different gains--there were twodistinct periodic attractors in this nonlinear dynamical system.This behavior was duplicated in Lazzaro's "anaLOG" circuitsimulator, one of the few simulators that implements areasonable model of MOS transistors in subthreshold.
Sincethe large-signal regime had more gain, a cochlea model built asa cascade of these stages could be quite well-behaved while allthe stages were in the small-signal region, and suddenly switchto a very nonlinear high gain mode if any stage got kicked upto its large-signal region (since all later stages would then bedriven into their large-signal high-gain regimes).
This resultwas very frustrating before we understood it--just as we wouldadjust the cochlea cascade to have a moderate gain peak, itwould burst into uncontrolled fractal-noise-like b havior.Mead showed that the second-order section can be stable forsmall signals and unstable for large signals, due to the tanhnonlinearity, but he did not discuss the effect of thenonlinearity on stable behavior for moderate-size signals.
Thekey to understanding the above behavior is a simple perturbedsmall-signal analysis.
For any given frequency, the small-signal linear analysis will easily show which amplifier in thefilter circuit has the largest differential input voltage (theanswer may be frequency-dependent---consider frequencies nearthe pole frequency).
That will be the first amplifier to start tofeel the effect of the tanh, which, to first order, will be toslightly reduce the transconductance of that amplifier.
So, topredict how the poles will move and how the gain will changeas input amplitude increases, it is only necessary to do a small-signal analysis with the original circuit parameters and thenwith a slightly modified parameter.For the ORD2 circuit, the first forward amplifier sees thebiggest signal, so its gain is perturbed ownward, equivalent tolengthening the time constant x1, reducing the pole frequencyand increasing the Q and hence the gain.
Having the gainincrease with increasing input level is exactly the opposite ofwhat we need--it is expansive rather than compressive.The second-order DIF2 circuit of figure 3 is a simpler circuitin which the Q is varied by biasing the two amplifierssymmetrically about the point corresponding to the polefrequency (arithmetically symmetric bias voltage leads togeometrically symmetric bias currents and time constants, dueto the exponential characteristic of the transistor insubthreshold).
The Q is the square root of "t2/Xl.
For lowenough Q settings, the first amplifier saturates first, increasing"t 1 as above.
The pole frequency is also exactly proportional tothe reciprocal square root of x l, so the Q is reduced inporportion the pole frequency.
But with higher initial Qsettings, the second amplifier saturates first, and the circuit isagain expansive.
Since a cascade of such stages will have awide range of actual Q values, some will run into problems.The third-order DIF3 circuit of figure 4 produces a transferfunction that is flatter at low frequencies, as our hydrodynamicanalysis suggests for the real cochlea; the resultingpseudoresonant gain peak is somewhat narrower than what weget with second-order stages.
But the circuit still has the samestability problems.To fix the problems, it is necessary to get some control overwhich amplifier educes its gain first.
In the ORD2, we want thefeedback amplifier to compress while the forward amplifiersremain relatively linear.
For the DIF3, we want the first stageto compress while the other two stages remain relatively linear.In the ORD2, the perturbation analysis then shows the polesstaying exactly fixed in frequency and changing Q.
For theDIF3, numerical studies in Mathematica TM showed that the213poles move in approximately the right directions, with Q beingreduced and frequency changing only a little.
How to getcontrol of the linear range is then the key problem.We have also built third-order filters by combining DIF2with a first-order section.
To try to stabilize thisconfiguration, we considered always letting the first amplifierof the DIF2 saturate first.
Such a circuit would have Q andcomplex pole frequency reduce proportionately as signal levelincreased.
This sounds about right, and it does decrease thegain near the initial pole frequency, but it can actually increasethe gain at lower frequencies, resulting in the same kind of two-region behavior over a limited range of parameters.Amplifier circuitsThe basic transconductance amplifier circuit is shown infigure 5.
Compared to an operational amplifier, it is verysimple and low-power, and has no critical transistor geometriesif operated in subthreshold with audio-band signals.
Typicaldevice sizes used are 8-by-8 microns; minimum-size d vices areavoided since flicker noise increases as the reciprocal of gatearea, and there is little space advantage of making themsmaller.w-t l -v-vu--t bias~_L_currentFigure 5: The transistor-level circuit for the simpletransconductance amplifier.Using the MOSIS low-noise analog BiCMOS process, wehave also experimented with amplifiers in which the uppermirror devices are replaced by quiet NPN bipolars, and the lowerthree devices are pMOS (which are quieter than nMOS due to thelower energy of the Fermi level relative to trap states).
Withthis modification, the amplifiers proved to be relatively quiet,but we still got enormous fractal-like noise out of cochleacascades, which is what put us on the right track.Rather than focusing on low-noise amplifiers, we thenturned our attention to expanding the linear input range.
Linearmicropower circuits are quite difficult to build.
To achieverobust operation with the simple nonlinear circuits, it turns outthat the ratio of transconductance to saturation output currentneeds to be modified on some amplifiers relative to the others.Reducing the transconductance relative to the output or biascurrent is equivalent to increasing the width of the linear inputrange.The first method we used was capacitive voltage dividers atthe inputs, as shown in figure 6, to reduce the signal seen at thenonlinear differential pair.
Since capacitors are essentiallyperfect and the differential-pair inputs are insulated gates, wefigured it could operate ssentially down to DC.
So we usedthese for the forward amplifiers in an ORD2-based cochlea,keeping the simple amplifier in the feedback position.I out~ q ~~cubiarr~nt~Figure 6: The circuit for the transconductance amplifier usingcapacitive dividers to extend the linear input range and reducethe transconductance relative to the bias current.tWe were mistaken.
It turns out that in this capacitivelycoupled circuit, a dominant effect that we ignored is the strayfeedback capacitiance (Miller capacitiance) between theamplifier output and its inverting input.
For the values we used,this reduced the open-loop amplifier voltage gain from about500 to only about 30, resulting in a follower gain of only about0.97, or a second-order section gain of only 0.94 at lowfrequencies.
A cascade of these stages quickly attenuated thesignal.Some time later the usefulness of the capacitive couplingidea was revived when it was suggested, by Tobi Delbriick, thatit could be used in the second amplifier of the DIF2 stage, sincethe loop is closed at DC by the first amplifier, which remainsDC coupled.
As discussed in the above subsection, theresulting DIF2 behavior was not quite right, but the ideaextended nicely to the DIF3.We built a DIF3-based cochlea cascade with this amplifier inpositions 2 and 3, and did extensive characterizations on it.We were able to get gains as high as 40 dB after 36 stages, withan overall compressive characteristic, and we saw no signs ofthe previous tendency to burst into noise.
But the signal levelto which it tended to compress was only about 100 mV peak-to-peak, and at high gain settings the noise output with zero inputwas about 40 mV peak-to-peak.
The circuit was usable butnoisy over about a 40 dB input dynamic range.At this point we revived another old idea that had beenpreviously discarded ue to its impact on the common-modeoperating range of the amplifier.
The idea was to interpose apair of diode-connected transistors between the differentialinput transistors and the tail current ransistor, as shown infigure 7.
This modification results in a widening of input rangeand a corresponding gain reduction by a factor of about 2.5 to3, depending on body effect.
Since it is DC-coupled, thiscircuit works fine in the forward path of the ORD2.214This amplifier circuit can also be generalized to have anynumber of diodes in series, for even wider linear differentialinput range at the cost of a severe reduction in common-modeoperating range.
Lloyd Watts and Xavier Arreguit at Caltechhave characterized many variations of this amplifier, as well asORD2 circuits and cochleas based on it, which are quite wellbehaved.V ~V-q  bias~..L_ currentFigure 7:The circuit for the transconductance amplifier usingdiode-connected transistors to extend the linear input range andreduce the transconductance relative to the bias current.At this point our best cochlea circuit uses DIF3 with twodiode pairs in the second and third amplifiers, and one diodepair in the first amplifier.
Due to the widened range at the firstlimiting amplifier, the output tends to compress toward about250 mV peak-to-peak, and the noise is somewhat lowered due tothe use of even larger transistors and capacitors.
A cochlea of168 stages fits nicely along one edge of our most recentcorrelogram chips, described in a later section.AUTOMATIC  GAIN  CONTROLNone of our cochlea chips so far has had on-chip closed-loopgain control as hypothesized by the model.
Gains have beenmanually adjusted, and with the new chips the instantaneousnonlinear compression does some of the job of adapting tosignal levels as well.
But to take advantage of what we learnedin our early computer models, we really need a multi-channelcoupled AGC with appropriate dynamics.
Failures of earlyattempts are now understood in terms of the inherent poorstability properties of the old cochlea circuits.
A new attemptto close the gain-control loop is underway.In a coupled AGC, each cochlear place channel is rectifiedand fed back as a gain-reduction signal to not only that channelbut also in lesser amounts to other nearby channels.
Thefeedback path is smoothed through a time and space domainloop filter, in order to regulate the dynamics (attack and decaytimes) and the spatial spread (lateral inhibition or spread ofsuppression).
The stability of the closed-loop system involvesthe phase shift of the loop filter, the added delay involved infeeding back to earlier channels (the effect propagates down thecochlea cascade at group velocity), and the loop gain.
For loudattack transients, the nonlinear nature of such a loop tends toincrease the loop gain, quickening the overall time constant othe point where even a little extra delay in the loop has thepotential to make it unstable \[5\].We have recently tested a digital computer implementationof a new AGC loop filter structure that structurally resemblesthe mulitple loops analyzed by Slaney \[5\].
But rather thancascading independent AGC stages as there, the four coupled-first-order time-space filters are run in parallel, each takingdetected channel outputs, and adding their output to produce again-reduction signal.
By choosing appropriate combiningweights and time constants, it is possible to make the filterhave roughly a constant 45-degree phase lag over a very widerange of frequencies while the gain drops off at about 3 dB peroctave.
This filter works well in computing good-lookingcochleagrams and correlograms, and should be easy to getworking in analog VLSI.CORRELATOR ARRAYSCorrelograms, or moving images of arrays of correlationvalues indexed by cochlear place and a delay parameter, are anexciting sound representation with which we have beenexperimenting for a number of years \[6\].
While most of ourexperiments have been done on digital computers, we havebuilt several arrays of analog correlation cells that eachcompute one pixel of a correlogram in real time.
Severalapproaches to implementing the delays and multipliers neededin a correlator were discussed a few years ago \[7\].
Since thattime, we have developed the surface-channel CCD analog delayline approach into a working correlogram demonstration, whileMead and his colleagues at Caltech have demonstrated yetanother idea, due to Shamma--using a second (contralateral)cochlea to provide a relative delay in a binaural system \[8, 9\].Lazzaro has continued to pursue designs based on pulse delaylines and simulated action potentials \[10, 11, 12\].
Thearchitecture, motivation, and applications for these arrays arewell discussed in the references; we focus here onimplementation issues.The key to a good correlator is a good delay mechanism.Neither the binaural "stereausis" technique used by Mead nor the"axon" pulse delay lines used by Lazzaro were judged to haveadequate delay-bandwidth product or amplitude resolution, norwere they very area efficient.
Charge-coupled devices provide amore ideal delay mechanism.
The CCD delay line approachpromises to provide the best performance for pitch detectionand sound separation applications, since it has inherently gooddelay-bandwidth product, precisely matched delays, andcontinuous analog values.We decided to base our correlator array on surface-channelCCD's, rather than the higher-quality buried-channel ones, forseveral reasons.
The use of surface channels results in non-ideal CCD's, but for audio-band sample rates the transferefficiencies are good enough.
Their advantage is that unlikeburied-channel devices, which can be made with the MOSISlow-noise analog process, the surface-channel devices can bebuilt in an ordinary double-poly digital process, and canoperate with on-chip 5-volt clock drivers.
To debug theconcept and tune up the cell design, we built a series of testchips using the cell of figure 8 and variations.
For inputvoltages from near ground to about 1.5 V, the sense voltagefollows the delayed input signal with a gain of about one-third,which is adequate.
Special on-chip clock drivers using current-215starved inverters generate slow clock transitions to preventcharge dispersal.
With a clock rate of 20 kHz, smearing due tocharge transfer inefficiency across 70 stages is not noticable.Reset/Leak "T"  "T"i corr "7"Broadcast I V senseIn __1 CCD (Compound Transistor)Figure 8: The circuit for two stages of four-phase CCD delayline with one correlation/integration/readout cell.
The 03clock couples capacit ively to the po ly l  gate thatnondestructively senses the charge in the CCD channel.
Thecorrelation current being integrated on the 1 pF storagecapacitor is small except during the sense interval when 06 and~3 are both high and the other clock phases are low (then it canbe as high as 1 nA).
If the broadcast and V sense voltages areappropriate logarithms of the input, the current icorr can be anaccurate one-quadrant product.We have scaled up this design to an 84-channel by 70-lagcorrelator array, which fits in the MOSIS 4.6 by 6.8 mm diesize using 2-micron rules.
After several bugs in the videoscanout t iming circuits were fixed, we succeeded indemonstrating real-time moving correlograms on a videomonitor.
So far, however, the correlograms are redundant alongone dimension, since the cochlea was not integrated onto thistest chip, and all the rows were tied together.Two new versions currently in fab combine the workingcorrelator array with the working DIF3-diodes cochlea designand new circuits to tie them together.
The circuits between thecochea and the correlator were designed to allow flexibleexternal control of average correlation current levels, degree ofco.mpression, degree of level-shift for the CCD charge input,etc.
We expect hese chips to produce high-quality correlogramdisplays of the sort that Licklider envisioned in 1951 \[13\].What could possibly go wrong?DISCUSSIONLyon and Mead's 1988 cochlea chip worked, as documentedin their publications, but was severely limited in its stablerange of sharpness and gain tuning, and in its dynamic range ofsignal amplitudes.
The problem addressed by that chip is stillbeing explored: how to implement computationally intensiveauditory processing in silicon, taking advantage of the powerand area efficiencies of a subthreshold analog MOS approach,while working around its inherent limitations.
Concurrently,we have continued to explore digital implementations usingcustom silicon as well as standard programmable architecturesand radically-parallel programmable architectures.
Only theanalog approach currently appears to have the possibility of (a)putting a cochlea and a correlator array on a single chip, and (b)operating them at a power low enough to consider for a battery-powered portable device.The correlation arrays discussed above contain 5880 cells,each containing a one-transistor multiplier and two analogstate-variable storage sites.
Clocking at 40 kHz, the equivalentmemory bandwidth is 470.4 million read-modify-writes persecond.
The equivalent floating-point operation rate is aboutthe same.
Digital versions on our Cray X/MP take advantage ofblock processing and fast transform algorithms to bring thesenumbers down to where they operate in near real time, butmaking a one-chip custom digital version is still too difficult.Using the analog approach, expanding the chip to 100channels by 300 lags will be no problem using 1.2-micronCMOS rules and slightly larger chips.Interpreting the correlograms is the next challenge.Distributing the next level of processing over the correlationarray is a reasonable direction to keep real-time performance.REFERENCES1.
Lyon, R.F., and Mead, C. "An Analog Electronic Cochlea," IEEETrans.
ASSP 36: 1119-1134, 1988.2.
Lyon, R.F., and Mead, C. "Cochlear Hydrodynamics Demystified,"Caltech Computer Science Technical Report Caltech-CS-TR-88-4,Pasadena, CA, 1988.3.
Lyon, R.F.
"Automatic Gain Control in Cochlear Mechanics,"Mechanics and Biophysics of Hearing.
(June 1990 Madison workshopproceedings) In press.4.
Mead, C~, Analog VLSI and Neural Systems.
Addison-Wesley,Reading MA, 1989.5.
Slaney, M., "Lyon's Cochlear Model," Apple Technical Report #13,Apple Computer, Cupertino CA, 1988.6.
Lyon, R.F., "Computational Models of Neural Auditory Processing,"Proceedings IEEE International Conference on Acoustics, Speech, andSignal Processing, pp.
36.1.1-4, San Diego, March, 1984.7.
Lyon, R.F., "Analog VLSI Hearing Systems," in Brodersen andMoscovitz (eds.
), VLSI Signal Processing 111 (workshop proceedings)pp.
244-251, IEEE Press, 1988.8.
Shamma, S.A., Shen, N., and Gopalaswarmy, P., "Stereausis:Binaural processing without neural delays," J. Acoust.
Soc.
Am.
86:989-1006, 1989.9.
Mead, C., Arreguit, X.,and Lazzaro, J., "Analog VLSI Model ofBinaural Hearing," IEEE Trans.
Neural Networks, in press.10.
Lazzaro, J. and Mead, C., "A silicon model of auditorylocalization," Neural Computation 1: 41-70, 1989.11.
Lazzaro, J. and Mead, C., "Silicon models of auditory localization,"in Zornetzer, Davis, and Lau (eds.
), An Introduction to Neural andElectronic Networks.
New York: Academic Press, pp.
158-174, 1990.12.
Lazzaro, J. and Mead, C., "Silicon modeling of pitch perception,"Proceedings National Academy of Sciences 86: 9597-9601, 1989.13.
Licklider, J.C.R., "A Duplex Theory of Pitch Perception,"Experientia 7: 128-133, 1951.216
